## 📡 웹 소켓(WebSocket)이란?

### 1. 개요

웹 소켓은 **웹을 위한 양방향 통신 프로토콜**입니다. 일반적으로 웹은 HTTP 기반의 요청/응답 방식으로 통신하지만, 웹 소켓을 사용하면 **브라우저와 서버 간의 실시간, 전이중 통신**이 가능합니다.

- TCP는 본질적으로 양방향 통신이 가능하지만, 웹에 직접 노출되면 보안상 위험이 큽니다.  
- 그래서 웹에서는 TCP 대신 **HTTP 위에서 작동하는 안전한 양방향 통신 방식**, 즉 웹 소켓이 사용됩니다.

---

### 2. 웹 소켓은 어떻게 작동할까?

#### 🧾 웹 소켓 핸드셰이크 (Handshake)

1. 클라이언트가 HTTP 프로토콜을 사용해 웹 소켓 연결을 요청합니다:
   ```
   GET /chat HTTP/1.1
   Host: example.com
   Upgrade: websocket
   Connection: Upgrade
   Sec-WebSocket-Key: <랜덤 키>
   Sec-WebSocket-Version: 13
   ```

2. 서버는 다음과 같이 응답하여 프로토콜을 `HTTP`에서 `WebSocket`으로 전환합니다:
   ```
   HTTP/1.1 101 Switching Protocols
   Upgrade: websocket
   Connection: Upgrade
   Sec-WebSocket-Accept: <서명된 키>
   ```

3. 이후, HTTP는 더 이상 사용되지 않고 TCP 기반의 웹 소켓 연결로 대체됩니다. **양방향 통신**이 가능한 상태가 됩니다.

---

### 3. 웹 소켓 주소 체계

- 비보안: `ws://example.com`
- 보안: `wss://example.com`

---

## 🔄 웹 소켓 vs HTTP

| 특징                 | HTTP                              | WebSocket                        |
|----------------------|-----------------------------------|----------------------------------|
| 통신 방식            | 요청/응답 기반 (단방향)          | 전이중 통신 (양방향)            |
| 연결 유지 여부       | 기본적으로 연결 해제됨           | 연결을 지속함                   |
| 실시간 통신 지원     | 불편함 (폴링 필요)               | 실시간 통신에 적합              |
| 방화벽 친화성        | 높음                             | 상대적으로 높음 (HTTP 기반)     |
| 상태 유지 여부       | 무상태(stateless)                | 상태 유지(stateful)            |
| 서버 푸시            | 불가능 / 폴링 필요               | 가능                             |

---

## 🛠 웹 소켓 사용 사례

- 채팅 애플리케이션 (WhatsApp, Discord 등)
- 실시간 피드 (트위터 스트리밍, 뉴스 속보)
- 멀티플레이어 게임
- 실시간 알림 시스템 (Push Notification)
- 금융 거래 시스템 (주식 시세 등)

---

## ✅ 장점

- **실시간 양방향 통신 가능**
- **낮은 오버헤드**: HTTP 요청/응답 반복이 없음
- **빠른 응답 시간**
- **방화벽 우회 가능성 높음**: HTTP를 기반으로 하기 때문
- **서버 푸시 기능 내장**

---

## ⚠ 단점

- **상태 유지**: 서버가 클라이언트의 연결 상태를 관리해야 함
- **프록시/중간 장비 처리 복잡성**: WebSocket을 제대로 지원하지 않는 경우도 있음
- **수평 확장 어려움**: 연결이 오래 지속되기 때문에 로드 밸런싱 복잡
- **유지 관리 이슈**: Ping/Pong 등 keep-alive 처리가 필요
- **안정성 문제**: 라우터/방화벽에 의해 연결이 예기치 않게 끊길 수 있음

---

## 📌 웹 소켓은 언제 써야 하나?

- **실시간성**이 중요할 때
- 서버가 **능동적으로 클라이언트에게 알림을 전송해야 할 때**
- 지속적인 연결이 허용되고, 상태 유지가 가능할 때

💡 단, 단순한 웹 서비스나 불특정 다수에게 빈번히 연결이 발생하는 서비스에는 **SSE(Server-Sent Events)** 또는 **HTTP Long Polling**도 고려할 수 있습니다.
